> This document was translated by GPT-4

---

title: v6.1 CE Release Notes
permalink: /release-notes/release-6.1-ce

---

# v6.1.8.5 [2023/01/12] LTS

- Bugfix

# v6.1.8.4 [2023/01/05]

## New Features

- Management
  - Support for specifying database names when using managed MySQL

# v6.1.8.3 [2022/12/29]

- Bugfix

# v6.1.8.2 [2022/12/22]

## New Features

- AutoMetrics、AutoTracing
  - Added support for SOFARPC protocol
- Grafana
  - Added support to be used as Grafana Tempo data source, displaying Tracing data on the Tempo page

# v6.1.8.1 [2022/12/15]

## New Features

- AutoMetrics
  - Pre-aggregated eBPF Request Log to supplement application performance metrics data of tap_side = [client process/server process](https://deepflow.yunshan.net/docs/zh/features/universal-map/auto-metrics/#统计位置说明)

# v6.1.8 [2022/12/09]

## New Features

- AutoMetrics、AutoTracing
  - Added support for ProtobufRPC protocol cluster, the current version supports [KRPC](https://github.com/bruceran/krpc/blob/master/doc/develop.md) protocol
- Management
  - Added a signal_source tag field to the data table to represent the signal source. The three currently supported signal sources are: Packet (cBPF), eBPF, OTel.
  - deepflow-agent supports running in K8s macvlan/ipvlan CNI environments and automatically calculates Pod relationships and performance indicators, with detailed configuration methods for macvlan environments referred to the [documentation](../best-practice/special-environment-deployment/#macvlan)
  - Supports deepflow-agent running in K8s Pod without SYS_ADMIN permissions, detailed permissions requirements refer to [documentation](https://deepflow.yunshan.net/docs/zh/ce-install/overview/#运行权限及内核要求)
  - Supports configuration of the [maximum length](https://github.com/deepflowio/deepflow/blob/main/server/controller/model/agent_group_config_example.yaml#L252) of eBPF Socket Data collected by deepflow-agent to improve collection performance
  - Support configuration of [resource information](https://github.com/deepflowio/deepflow/blob/main/server/server.yaml#L28) synchronized in deepflow-server to ingester module to reduce resource consumption of ingester module's AutoTagging function under multiple K8s clusters

## Optimization

- Management
  - By compressing and clipping messages, it reduces the memory overhead of deepflow-agent when watching K8s apiserver
  - Optimized the memory consumption of deepflow-server in calculating service Tag by aggregating Pod
  - By pre-aggregating memory, optimize the write pressure of deepflow-server on flow_tag database
  - Managed MySQL services support non-root user connections

# v6.1.7 [2022/11/23]

## New Features

- Metrics
  - Mark content_length etc. in OTel as metrics, detailed field mapping refers to [documentation](https://deepflow.yunshan.net/docs/zh/features/universal-map/l7-protocols/)
  - Request Log adds session_length metric
- Tracing
  - Supports the parsing of sw8 field in Dubbo protocol, and extracts TraceID, SpanID
- Event
  - Automatically generate events of addition, deletion, and modification of cloud servers and K8s Pod, and add a [Grafana Dashboard](https://ce-demo.deepflow.yunshan.net/d/Event/event?orgId=1)
- Management
  - Supports the configuration of the port range for application protocol parsing to reduce the false positive rate. The configuration method refers to [l7-protocol-ports configuration items](https://github.com/deepflowio/deepflow/blob/main/server/controller/model/vtap_group_config_example.go#L816)
  - deepflow-agent supports the use of a fixed load balancer IP address to request deepflow-server, the configuration method refers to [proxy_controller_ip and analyzer_ip fields](https://github.com/deepflowio/deepflow/blob/main/server/controller/model/vtap_group_config_example.go#L215)
  - Supports specifying [tap-mode](https://github.com/deepflowio/deepflow/blob/main/server/controller/model/vtap_group_config_example.go#L127) in agent-group-config, so that deepflow-agent can run in a special CNI environment like macvlan
  - Supports the configuration of [kubernetes-cluster-name](https://github.com/deepflowio/deepflow/blob/main/agent/config/deepflow-agent.yaml#L27) in deepflow-agent.yaml to specify the K8s cluster name

## Optimization

- SQL API
  - When the automatic grouping resource type resource_glX_type is an IP address, it directly reuses resource_glX_id to represent the subnet ID and resource_glX to represent the IP address
- Management
  - Lower the database permission requirements when using managed RDS and ClickHouse
  - Auto-balance the number of deepflow-agents for each deepflow-server service
  - Monitor the internal call chain of deepflow-server using OpenTelemetry

# v6.1.6 [2022/11/09]

## New Features

- AutoMetrics
  - HTTP protocol adds attribute.http_user_agent and attribute.http_referer fields
  - Added attribute.rpc_service field, the value is ServiceName of Dubbo/gRPC
  - Added endpoint field, the value is ServiceName/MethodName of Dubbo/gRPC
  - Supports marking HTTP2 data compliant with gRPC protocol specification as gRPC (rather than HTTP2) protocol
- AutoTagging
  - Support the synchronization of AWS public cloud resource information and automatically inject it into observability data as Tags
  - Support for tagging observability data of K8s clusters hosted on public clouds with cloud resources and container labels at the same time
- Management
  - Supports configuration of deepflow-agent to turn on or off parsing of various application protocols
  - Supports configuration of the regular expression of Golang/openssl process name for deepflow-agent to collect data via eBPF uprobe
  - Supports deepflow-agent standalone mode, where Flow Log and Request Log are written to local log files
  - Supports i18n, with English as the default display

## Optimization

- AutoMetrics
  - Matches SQL keywords to reduce false positive rates of MySQL and PostgreSQL protocol recognition
- Grafana
  - Displays SQL query statements in the Query Editor of Panel to help developers understand how to call API
  - Optimizes the display of empty field information in the Distributed Tracing flame graph
- Management
  - Optimizes traffic between deepflow-server and clickhouse, giving priority to writing to the same node's clickhouse Pod
  - Supports the compression of OTel Span data received by deepflow-agent. The bandwidth consumption when sent to deepflow-server can be reduced by about 7 times

# v6.1.5 [2022/10/26]

## New Feature

- AutoMetrics, AutoTracing
  - Supports the collection of PostgreSQL performance indicators and access logs, and associates them with distributed tracing
  - Supports the collection of performance indicators and access logs of HTTPS using the openssl library, and associates them with distributed tracing
- Integration
  - deepflow-server supports providing a RemoteRead interface for Prometheus
  - deepflow-agent supports bypassing otel-collector to receive OpenTelemetry data directly
  - Grafana Variable's query statement supports using custom variables and built-in variables, please [see the documentation](../integration/output/query/sql/#使用-tag-自身名称过滤) for details. Use cases include:
    - Using the current selected value of the variable pod_cluster to filter the range of values for the variable pod
    - Use the input content of the variable ingress_wildcard to change the range of values of the variable ingress
    - Using the current value of the built-in variables `$__from` and `$__to` to enhance the query speed of the variable value range
    - Added two zero-intrusion observability Dashboards in Grafana: K8s Ingresss, SQL Monitoring
- SQL API
  - Tag of type `string_enum` and `int_enum` supports using the `Enum()` function to translate Value to Name for query filtering and result return
  - Supports SELECT tags/attributes/labels to query all tag.X/attribute.X/label.X fields of each row of data, no need to specify specific field names
- Management
  - Supports ClickHouse cold data using disk (as an alternative to object storage)
  - Support to use `deepflow-ctl agent rebalance` to balance deepflow-agent to added and restored deepflow-server

## Optimization

- AutoMetrics
  - Combs the application protocol parsing process, lowers the threshold for [adding support for more application protocols](https://github.com/deepflowio/deepflow/blob/main/docs/HOW_TO_SUPPORT_YOUR_PROTOCOL_CN.MD)
- AutoTagging
  - Added `deepflow-ctl cloud info` command to debug resource information synchronized from cloud platform API
- SmartEncoding
  - Recycle the Tag encoding value of deleted resources, enhance the compression ratio and query speed
- SQL API
  - Optimizes the display_name of the enumerated values of the server_port Tag field, includes the corresponding int value to avoid unclear meaning
- Management
  - deepflow-server changed to use Deployment Controller for deployment, **please upgrade the helm chart when upgrading**
  - deepflow-agent supports running in non-privileged mode, please consult the specific permissions requirements from the [documentation](https://deepflow.yunshan.net/docs/zh/ce-install/overview/#运行权限及内核要求)
  - Optimized the mapping relationship between Prometheus metrics and DeepFlow Table, each Metrics corresponds to a Table

# v6.1.4 [2022/10/12]

## New Features

- AutoTagging
  - Supports the synchronization of Tencent public cloud resource information and automatically injects it into observability data as tags
- AutoTracing
  - Supports the association of application Span and network Span in environments where eBPF cannot run, eliminating tracing blind spots
- SQL API
  - The show tags command now returns fields of type map, such as labels, attributes, tags
  - The show tag values command now supports limit, offset, like parameters
- Production Environment Deployment
  - Supports the use of managed ClickHouse and MySQL
  - deepflow-agent supports configuration distribution by deepflow-server when registration is not completed
- Grafana
  - Added DeepFlow self-monitoring Dashboard

## Optimization

- SQL API
  - Metric data in OTel Span can be returned through the show metrics API
- System Capability
  - Supports completion of deepflow-server master election without depending on sidecar
  - deepflow-server supports backward compatibility with deepflow-agent
  - Default sync with NTP server on the node where deepflow-server container is located
  - Standardized process -v output

# v6.1.3 [2022/09/23]

## Applications

- AutoMetrics
  - Add indicators: client waiting delay, number of SYN packets, number of SYN-ACK packets, number of SYN retransmission packets, number of SYN-ACK retransmission packets
  - Supports the collection of Golang HTTP2, HTTP2_TLS calls using eBPF uprobe
  - Supports the collection of uprobe data from Golang processes that have clipped the standard symbol table (Golang >= 1.13 and < 1.18)
- AutoTracing
  - Support the association of eBPF uprobe Span with cBPF Span, OTel Span, and display in the tracing flame graph
- AutoTagging
  - For K8s nodes not associated with cloud servers, automatically generate cloud server tags
  - Supports synchronization of Huawei public cloud resource information
- Querier SQL API
  - Fields after GROUP BY are automatically returned, no explicit declaration is required after SELECT
- Grafana
  - Added interactive DeepFlow Query
